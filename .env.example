# STEREOS Environment Configuration

## Required Environment Variables

Copy this file to `.env` and fill in your values.

### Root / API (local dev and Workers secrets)

```env
# Database (required – API will fail with ECONNREFUSED if unreachable)
# Option A: Local Postgres – start it first (e.g. brew services start postgresql@14, or Docker)
DATABASE_URL=postgresql://user:password@localhost:5432/stereos
# Option B: Hosted Postgres (Neon, Supabase, etc.) – use the connection string they provide
# DATABASE_URL=postgresql://user:pass@host.neon.tech/neondb?sslmode=require

# API Server (local)
PORT=3000
TRUSTED_ORIGINS=http://localhost:5173,http://localhost:3000
# Frontend origin for invite/email links (defaults to first TRUSTED_ORIGIN if unset)
# FRONTEND_URL=http://localhost:5173

# Better Auth
BETTER_AUTH_SECRET=your-secret-key-here

# Email verification (Resend) – required for email/password sign-up
RESEND_API_KEY=re_xxxxxxxxxxxx
RESEND_FROM_EMAIL=STEREOS <onboarding@yourdomain.com>

# OAuth Providers (optional)
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# Stripe
STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
STRIPE_PRICE_ID=price_...
```

### Frontend (Netlify build env)

When deploying the web app to Netlify, set in the Netlify dashboard (or in `apps/web/.env` for local prod build):

```env
VITE_API_URL=https://stereos.your-domain.workers.dev
VITE_STRIPE_PUBLISHABLE_KEY=pk_test_...
```

Leave `VITE_API_URL` unset for local dev (Vite proxy handles /v1 and /auth). `VITE_STRIPE_PUBLISHABLE_KEY` is required for the start-trial embedded checkout page.

## Getting Started

1. **PostgreSQL must be running** (sign-up and auth will fail with `ECONNREFUSED` otherwise):
   - **macOS (Homebrew):** `brew services start postgresql@14` (or your version), then `createdb stereos`
   - **Docker:** `docker run -d -p 5432:5432 -e POSTGRES_PASSWORD=postgres -e POSTGRES_DB=stereos postgres:16`
   - **Hosted:** Create a DB at [Neon](https://neon.tech) or [Supabase](https://supabase.com) and set `DATABASE_URL` in `.env`

2. **Install dependencies**:
   ```bash
   npm install
   ```

3. **Run database migrations**:
   ```bash
   npm run db:migrate
   ```

4. **Start the development server**:
   ```bash
   npm run dev
   ```

## Stripe Setup

1. Create a Stripe account at https://stripe.com
2. Set up a product with usage-based pricing
3. Configure the webhook endpoint: `/v1/webhooks/stripe`
4. Add your API keys to the environment variables

## OAuth Setup

### GitHub
1. Go to Settings > Developer settings > OAuth Apps
2. Create a new OAuth App
3. Set callback URL to: `http://localhost:3000/v1/auth/callback/github`
4. Copy Client ID and Secret to environment variables

### Google
1. Go to Google Cloud Console > APIs & Services > Credentials
2. Create OAuth 2.0 Client ID
3. Add authorized redirect URI: `http://localhost:3000/v1/auth/callback/google`
4. Copy Client ID and Secret to environment variables
