name = "stereos"
main = "apps/api/src/worker.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat"]

# API-only worker. Frontend deploys separately (e.g. Netlify).

[vars]
# Your Worker URL (used by Better Auth callbacks)
BASE_URL = "https://api.trystereos.com"
# Comma-separated origins for CORS
TRUSTED_ORIGINS = "https://app.trystereos.com"
# Frontend URL used in magic link emails (link goes here, not API). Must match your app origin.
FRONTEND_URL = "https://app.trystereos.com"

# Secrets: npx wrangler secret put <NAME>
# - DATABASE_URL (Neon Postgres URL)
# - BETTER_AUTH_SECRET
# - STRIPE_SECRET_KEY
# - STRIPE_PRICE_ID
# - STRIPE_WEBHOOK_SECRET
# - OPENROUTER_BROADCAST_SECRET (required for /v1/traces ingest auth)
# - CF_ACCOUNT_ID (Cloudflare account ID for AI Gateway)
# - CF_AI_GATEWAY_API_TOKEN (Cloudflare API token with AI Gateway permissions)
# - RESEND_API_KEY (optional; for verification emails in Worker)
# - RESEND_FROM_EMAIL (optional; default )

[observability]
enabled = false
head_sampling_rate = 1

# Without destinations = [...], the Worker never sends data to your Observability Destination (stays "Never run").
# Use the exact destination name(s) from Workers & Pages → Observability → Destinations.
[observability.logs]
enabled = true
destinations = ["stereos"]
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = true
destinations = ["stereos"]
persist = true
head_sampling_rate = 1

[[routes]]
pattern = "api.trystereos.com"
zone_name = "trystereos.com"